<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dirty Road Detector</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>

    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #webcam-container canvas { max-width: 100%; }
    </style>
</head>

<body>
    <h2>Dirty Road Detection</h2>
    <button onclick="init()">Start Camera</button>

    <div id="webcam-container"></div>
    <div id="label-container"></div>

<script>
const URL = "./mymodel/";

let model, webcam, labelContainer;

async function init() {
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    model = await tmImage.load(modelURL, metadataURL);

    webcam = new tmImage.Webcam(320, 320, true);
    await webcam.setup({ facingMode: "environment" });
    await webcam.play();

    document.getElementById("webcam-container").appendChild(webcam.canvas);

    labelContainer = document.getElementById("label-container");
    labelContainer.innerHTML = "";

    for (let i = 0; i < model.getTotalClasses(); i++) {
        labelContainer.appendChild(document.createElement("div"));
    }

    window.requestAnimationFrame(loop);
}

async function loop() {
    webcam.update();

    // ðŸ”´ THIS LINE IS THE KEY FIX
    const predictions = await model.predict(webcam.webcam);

    for (let i = 0; i < predictions.length; i++) {
        labelContainer.childNodes[i].innerHTML =
            predictions[i].className + ": " +
            (predictions[i].probability * 100).toFixed(1) + "%";
    }

    requestAnimationFrame(loop);
}
</script>

</body>
</html>
