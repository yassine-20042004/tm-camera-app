<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dirty Road Live Detection</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    background:#111;
    color:#fff;
    text-align:center;
    font-family:Arial;
}
#container {
    display:inline-block;
    margin-top:10px;
}
canvas {
    border-radius:12px;
}
#result {
    font-size:26px;
    margin-top:15px;
}
button {
    padding:12px 24px;
    font-size:16px;
    cursor:pointer;
}
</style>

<!-- Load libs FIRST -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>
</head>

<body>
<h2>ðŸš§ Dirty Road Detection (LIVE)</h2>

<button onclick="start()">Start Live Detection</button>

<div id="container"></div>
<div id="result">Waiting...</div>

<script>
const MODEL_URL = "./mymodel/";

let model, webcam, isRunning = false;

// Load model once
async function loadModel() {
    model = await tmImage.load(
        MODEL_URL + "model.json",
        MODEL_URL + "metadata.json"
    );
    document.getElementById("result").innerText = "Model loaded. Start camera.";
}
loadModel();

// Start camera and LIVE loop
async function start() {
    if (isRunning) return;
    isRunning = true;

    webcam = new tmImage.Webcam(320, 320, false);
    await webcam.setup({ facingMode: "environment" });
    await webcam.play();

    const container = document.getElementById("container");
    container.innerHTML = "";
    container.appendChild(webcam.canvas);

    window.requestAnimationFrame(loop);
}

// Continuous prediction loop
async function loop() {
    webcam.update();

    const predictions = await model.predict(webcam.canvas);
    const best = predictions.reduce((a,b) =>
        a.probability > b.probability ? a : b
    );

    document.getElementById("result").innerText =
        `${best.className} â€” ${(best.probability * 100).toFixed(1)}%`;

    window.requestAnimationFrame(loop);
}
</script>
</body>
</html>
