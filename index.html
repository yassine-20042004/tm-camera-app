<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dirty Road Detector</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    background:#111;
    color:#fff;
    text-align:center;
    font-family:Arial;
}
#container {
    display:inline-block;
    margin-top:10px;
}
canvas {
    border-radius:12px;
}
#result {
    font-size:24px;
    margin-top:15px;
    color:#00ffcc;
}
button {
    padding:10px 20px;
    font-size:16px;
    cursor:pointer;
}
</style>

<!-- IMPORTANT: load scripts BEFORE using tmImage -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>
</head>

<body>
<h2>ðŸš§ Dirty Road Detection</h2>

<button onclick="start()">Start Camera</button>

<div id="container"></div>
<div id="result">Waiting...</div>

<script>
const MODEL_URL = "./mymodel/"; // âœ… LOCAL PATH

let model, webcam;

// Load model
async function loadModel() {
    model = await tmImage.load(
        MODEL_URL + "model.json",
        MODEL_URL + "metadata.json"
    );
    document.getElementById("result").innerText = "Model loaded. Start camera.";
}
loadModel();

// Start webcam
async function start() {
    webcam = new tmImage.Webcam(320, 320, true); // mirrored
    await webcam.setup({ facingMode: "environment" });
    await webcam.play();

    webcam.canvas.style.transform = "scaleX(-1)";

    const container = document.getElementById("container");
    container.innerHTML = "";
    container.appendChild(webcam.canvas);

    window.requestAnimationFrame(loop);
}

// Prediction loop
async function loop() {
    webcam.update();

    const predictions = await model.predict(webcam.canvas);
    const best = predictions.reduce((a,b) =>
        a.probability > b.probability ? a : b
    );

    document.getElementById("result").innerText =
        `${best.className} (${(best.probability * 100).toFixed(1)}%)`;

    window.requestAnimationFrame(loop);
}
</script>
</body>
</html>
